"use strict";!function($,window,document,undefined){function Plugin(element,options){this.element=element,this.settings=$.extend({},defaults,options),this.init()}var pluginName="dpnAutocomplete",defaults={ajax:{},categories:[],minChars:3,autocompleteClass:"dpn-autocomplete",itemListCallback:function(item,category){return"undefined"==typeof category?'<li class="item">'+item+"</li>":'<li class="'+category.name+' item">'+item+"</li>"},clickCallback:null,hoverCallback:null};$.extend(Plugin.prototype,{$element:{},$autocomplete:{},init:function(){this.$element=$(this.element),this.initDropdown(),this.initEvents()},initDropdown:function(){var html='<div class="'+this.settings.autocompleteClass+'" style="display: none;"><ul>';$(this.settings.categories).each(function(){var category=this;html+='<li class="category '+category.name+'" style="display: none;">'+category.label+"</li>"}),html+="</ul></div>",$(this.element).after($(html)),this.$autocomplete=$(this.element).next("."+this.settings.autocompleteClass)},initEvents:function(){var $selectedItem,$listItems,$lastItem,that=this,$list=this.$autocomplete.find("ul"),$firstItem={};$(this.element).on("input",function(){that.settings.minChars<=$(this).val().length?that.execAjaxRequest($(this).val()):that.closeAutocomplete()}),$(this.element).on("focus",function(){that.settings.minChars<=$(this).val().length&&that.execAjaxRequest($(this).val())}),$(this.element).on("focusout",function(){!1===that.$autocomplete.is(":hover")&&!1===that.$element.is(":hover")&&that.closeAutocomplete()}),$list.on("click","li.item",function(event){"function"==typeof that.settings.clickCallback&&that.settings.clickCallback(event,this,that.$element),that.closeAutocomplete()}),$list.on("mouseover","li.item",function(event){$selectedItem=$(this),$list.find("li.selected").removeClass("selected"),$selectedItem.addClass("selected"),"function"==typeof that.settings.hoverCallback&&that.settings.hoverCallback(event,this)}),$(this.element).on("keydown",function(event){!1===that.$autocomplete.is(":hidden")&&($listItems=that.$autocomplete.find("ul li.item"),$selectedItem=$list.find("li.selected"),$firstItem=$listItems.first(),$lastItem=$listItems.last(),(38===event.which||40===event.which||13===event.which)&&event.preventDefault(),27===event.which&&that.closeAutocomplete(),13===event.which&&0<=$selectedItem.length&&$selectedItem.trigger("click"),38===event.which&&(0===$selectedItem.length?$lastItem.addClass("selected"):$selectedItem[0]!==$firstItem[0]&&($selectedItem.removeClass("selected"),$selectedItem=$selectedItem.prevAll("li.item:first"),$selectedItem.addClass("selected"))),40===event.which&&(0===$selectedItem.length?$firstItem.addClass("selected"):$selectedItem[0]!==$lastItem[0]&&($selectedItem.removeClass("selected"),$selectedItem=$selectedItem.nextAll("li.item:first"),$selectedItem.addClass("selected"))))})},execAjaxRequest:function(input){var that=this;$.ajax(this.getAjaxSettings(input)).success(function(data){that.addSelections(data)})},getAjaxSettings:function(input){return"function"==typeof this.settings.ajax?this.settings.ajax(input):this.settings.ajax},addSelections:function(data){var category,that=this,categories=this.settings.categories.length,$list={};this.clearAutocomplete(),0===this.settings.categories.length?($list=that.$autocomplete.find("ul"),$(data).length>0?that.$autocomplete.show():that.closeAutocomplete(),$(data).each(function(){$list.append(that.settings.itemListCallback(this))})):$(this.settings.categories).each(function(){category=this,data.hasOwnProperty(category.name)&&($list=that.$autocomplete.find("ul li."+category.name),data[category.name].length>0?($list.show(),that.$autocomplete.show()):categories--,0===categories?that.closeAutocomplete():$(data[category.name]).each(function(){$list.after(that.settings.itemListCallback(this,category))}))})},closeAutocomplete:function(){this.$autocomplete.hide(),this.clearAutocomplete()},clearAutocomplete:function(){var $autocomListItems=this.$autocomplete.find("ul li");$autocomListItems.remove(".item"),$autocomListItems.each(function(){$(this).hide()})}}),$.fn[pluginName]=function(options){return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,options))}),this}}(jQuery,window,document);