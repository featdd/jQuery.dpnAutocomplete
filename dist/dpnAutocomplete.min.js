"use strict";!function(a,b,c,d){function e(b,c){this.element=b,this.settings=a.extend({},g,c),this.init()}var f="dpnAutocomplete",g={ajax:{},categories:[],minChars:3,autocompleteId:"dpn-autocomplete",autocompleteClasses:"dpn-autocomplete",itemListCallback:function(a,b){return"undefined"==typeof b?'<li class="item">'+a+"</li>":'<li class="'+b.name+' item">'+a+"</li>"},clickCallback:null,hoverCallback:null};a.extend(e.prototype,{$element:{},$autocomplete:{},init:function(){this.$element=a(this.element),this.initDropdown(),this.initEvents()},initDropdown:function(){var b='<div id="'+this.settings.autocompleteId+'" class="'+this.settings.autocompleteClasses+'" style="display: none;"><ul>';a(this.settings.categories).each(function(){var a=this;b+='<li class="category '+a.name+'" style="display: none;">'+a.label+"</li>"}),b+="</ul></div>",this.$element.after(b),this.$autocomplete=a("#"+this.settings.autocompleteId)},initEvents:function(){var b,c,d,e=this,f=this.$autocomplete.find("ul"),g={};this.$element.on("input",function(){e.settings.minChars<=a(this).val().length?e.execAjaxRequest(a(this).val()):e.closeAutocomplete()}),this.$element.on("focus",function(){e.settings.minChars<=a(this).val().length&&e.execAjaxRequest(a(this).val())}),this.$element.on("focusout",function(){!1===e.$autocomplete.is(":hover")&&!1===e.$element.is(":hover")&&e.closeAutocomplete()}),f.on("click","li.item",function(a){"function"==typeof e.settings.clickCallback&&e.settings.clickCallback(a,this),e.closeAutocomplete()}),f.on("mouseover","li.item",function(c){b=a(this),f.find("li.selected").removeClass("selected"),b.addClass("selected"),"function"==typeof e.settings.hoverCallback&&e.settings.hoverCallback(c,this)}),this.$element.on("keydown",function(a){!1===e.$autocomplete.is(":hidden")&&(c=e.$autocomplete.find("ul li.item"),b=f.find("li.selected"),g=c.first(),d=c.last(),(38===a.which||40===a.which||13===a.which)&&a.preventDefault(),27===a.which&&e.closeAutocomplete(),13===a.which&&0<=b.length&&b.trigger("click"),38===a.which&&(0===b.length?d.addClass("selected"):b[0]!==g[0]&&(b.removeClass("selected"),b=b.prevAll("li.item:first"),b.addClass("selected"))),40===a.which&&(0===b.length?g.addClass("selected"):b[0]!==d[0]&&(b.removeClass("selected"),b=b.nextAll("li.item:first"),b.addClass("selected"))))})},execAjaxRequest:function(b){var c=this;a.ajax(this.getAjaxSettings(b)).success(function(a){c.addSelections(a)})},getAjaxSettings:function(a){return"function"==typeof this.settings.ajax?this.settings.ajax(a):this.settings.ajax},addSelections:function(b){var c,d=this,e=this.settings.categories.length,f={};this.clearAutocomplete(),0===this.settings.categories.length?(f=d.$autocomplete.find("ul"),a(b).length>0?d.$autocomplete.show():d.closeAutocomplete(),a(b).each(function(){f.append(d.settings.itemListCallback(this))})):a(this.settings.categories).each(function(){c=this,b.hasOwnProperty(c.name)&&(f=d.$autocomplete.find("ul li."+c.name),b[c.name].length>0?(f.show(),d.$autocomplete.show()):e--,0===e?d.closeAutocomplete():a(b[c.name]).each(function(){f.after(d.settings.itemListCallback(this,c))}))})},closeAutocomplete:function(){this.$autocomplete.hide(),this.clearAutocomplete()},clearAutocomplete:function(){var b=this.$autocomplete.find("ul li");b.remove(".item"),b.each(function(){a(this).hide()})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))}),this}}(jQuery,window,document);